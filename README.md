# Commuting CO2 Emissions Analysis Project

This project is part of a master's thesis focused on analyzing commuting practices in the Netherlands and assessing the WPM (Work-Related Personal Mobility) reporting regulation. Using data from the ODiN 2022 Travel Survey and synthetic data generated through APIs, the goal is to develop a comprehensive CO2 emissions calculator. The project explores various methodologies to estimate emissions for different modes of transport and compares the results to evaluate the effectiveness of WPM guidelines.

## Project Overview

The project systematically processes commuting data, generates realistic synthetic routes for commuters, and compares CO2 emissions using multiple calculation methods. The following key stages outline the entire workflow:

1. **Data Processing**  
   Raw data from the ODiN 2022 Travel Survey is cleaned and processed to extract relevant information about commuting habits, including origin-destination pairs, modes of transport, travel times, and distances. This also includes data preprocessing for other external data sources, such as postcode datasets.

2. **Exploratory Data Analysis (EDA)**  
   Exploratory analysis is conducted to understand commuting behavior in the Netherlands. Various EDA techniques are applied to visualize transport modes, commuting distances, travel times, and the distribution of trips by zip code and destination.

3. **Route Generation**  
   Routes are generated using OpenTripPlanner (OTP) and other APIs to simulate real commuting scenarios. Synthetic origin-destination pairs are created based on the insights from ODiN data, and these routes are used to estimate travel distance, duration, and CO2 emissions.

4. **CO2 Emissions Calculation**  
   A calculator is developed to estimate CO2 emissions for each generated route using two methods:
   - **Standard Emission Factors**: Using widely accepted emission factors based on transport modes.
   - **WPM Methodology**: Emission factors based on WPM regulation, which uses fixed emission rates for modes of transport like cars, bicycles, and public transport. The calculator applies these emission factors to the distance traveled and provides estimates for each route.
  
5. **Hypothesis Testing**  
   Various hypotheses are tested to assess the impact of different commuting behaviors and calculation methodologies on CO2 emissions. This involves statistical tests such as t-tests, ANOVA, and linear regression to determine significant differences in emissions across transport modes and distances.

6. **Visualization**  
   The results of the analysis are visualized using graphs, charts, and maps. This includes visualizing route distributions, travel times, commuting distances, and the relative emissions generated by different modes of transport.

## Directory Structure

project_root/
│
├── data/
│   ├── csv/
│   │   ├── route_summary_with_commute_times.csv        # Summary of generated routes and commute times
│   │   ├── simplified_co2_emissions_summary.csv        # CO2 emissions summary
│   │   ├── top_destination_addresses.csv               # Top commuting destination addresses
│   │   ├── top_origin_addresses.csv                    # Top commuting origin addresses
│   └── graphs/                                         # Visualizations of data and analysis
│       ├── arrival_times.png                           # Arrival times distribution
│       ├── avg_distance.png                            # Average travel distance visualization
│       ├── avg_travel_distance_speed_bubble.png        # Bubble chart of distance vs speed
│       ├── avg_travel_duration.png                     # Average travel duration
│       ├── correlation_heatmap.png                     # Heatmap showing correlations between variables
│       ├── departure_times.png                         # Departure times distribution
│       ├── reimbursement_percentage_donut.png          # Donut chart for reimbursement percentages
│       ├── reimbursement_treemap.png                   # Treemap for reimbursement data
│       └── share_of_transport_modes_for_commuting.png  # Transport modes share chart
│   └── processed/                                      # Processed data files
│       ├── cleaned_georef-netherlands-postcode-pc4.csv # Cleaned postcode data
│       ├── expense_reimbursement_data.csv              # Reimbursement data
│       ├── mode_of_transport_commuting_percentages.csv # Transport mode statistics
│       ├── refined_work_related_commutes.csv           # Refined commute data for analysis
│       └── top_origin_zipcodes.csv                     # Origin zip codes for commuting
│   └── raw/                                            # Raw data files used in the project
│       ├── georef-netherlands-postcode-pc4.csv         # Raw postcode data
│       ├── ODIN2022_Databestand.csv                    # ODiN 2022 dataset (main dataset)
│       └── graph.obj                                   # Graph file for route generation
│
├── scripts/                                            # Python scripts used in the project
│   ├── Average_Car_Emission_Factors_NL.py              # Script to calculate average car emission factors
│   ├── CO2_Calculator.py                               # Main CO2 calculator script
│   ├── EDA_ODiN.py                                     # Exploratory Data Analysis for ODiN data
│   ├── EDA_Travel_Reimbursment.py                      # EDA script for travel reimbursement data
│   ├── Hypothesis_Testing.py                           # Hypothesis testing script
│   ├── OTP_routing.py                                  # Script for routing using OpenTripPlanner API
│   ├── Visualisation.py                                # Visualization script to generate graphs
│   ├── Zipcode_Processing.py                           # Script for cleaning and generating random addresses based on zip codes
│   └── utils/                                          # Utility functions and supporting modules
│
└── README.md                                           # Project overview and instructions

## Script Descriptions

### `CO2_Calculator.py`
This script calculates CO2 emissions for commuting trips using two methods: 
1. **Method 1 (WPM TTW Factors)**: This method calculates CO2 emissions based on WPM regulation-specific transport mode factors (e.g., cars, bicycles, transit). It applies factors provided by WPM to each generated trip's distance.
2. **Method 2 (WTW Factors)**: Uses Well-to-Wheel (WTW) emission factors for the same trips. The script outputs the total distance and emissions using both methodologies for each commuting trip. 

The output is saved in a CSV file that contains the origin, destination, mode of transport, total distance, and CO2 emissions for each generated trip.

### `Zipcode_Processing.py`
This script processes geospatial zip code data to generate random valid addresses within specific zip codes. It takes cleaned postcode geospatial data (from OSM) and generates a list of top commuting origin and destination addresses based on the top commuting zip codes. The script interacts with the Nominatim API to reverse-geocode the generated random points to human-readable addresses. The final output is a set of CSV files containing origin and destination addresses with associated coordinates.

### `OTP_routing.py`
This script generates realistic commuting routes between origin and destination addresses using the **OpenTripPlanner (OTP)** API. The script selects origin and destination points, generates a random commuting time within typical commuting windows (morning and evening rush hours), and calls the OTP API to calculate routes for three transport modes: **Bicycle**, **Car**, and **Transit**. 

Each route is then processed to calculate the total distance traveled, time taken, and transit details (e.g., which buses or trains are used). The results are saved in a CSV file that includes the origin, destination, total trip details, and leg-by-leg transport mode information.

### `Hypothesis_Testing.py`
This script performs the statistical testing required for the project’s hypotheses. The script uses commuting data and the results from the CO2 calculator to compare emissions across different scenarios. Statistical tests like **paired t-tests**, **ANOVA**, and **F-tests** are applied to compare the CO2 emissions between different transport modes and distances. This helps to determine whether certain transport modes or commuting distances result in significantly different emissions when using the WPM methodology versus traditional emission calculation methods.

### `EDA_ODiN.py`
This script performs exploratory data analysis (EDA) on the ODiN 2022 dataset to extract key insights into Dutch commuting patterns. The script focuses on analyzing commuting distances, travel durations, and the distribution of different transport modes. It helps to provide a baseline understanding of how the population commutes and informs the synthetic data generation and route simulation processes.

### `EDA_Travel_Reimbursment.py`
This script analyzes reimbursement data to understand the financial compensation that commuters receive for travel expenses. It explores trends in travel reimbursements across different industries and job types, identifying patterns in how travel costs are compensated. The output is visualized in donut charts and treemaps, showing the share of reimbursement amounts across different categories.

### `Visualisation.py`
This script generates various visualizations based on the project’s commuting and CO2 emission data. The visualizations include maps, graphs, and charts that show transport mode shares, travel distances, CO2 emissions, and correlations between variables such as travel time, mode of transport, and distance. The visualizations are used for presentations and help communicate the findings from the analysis.

## Data Files

- **route_summary_with_commute_times.csv**: Contains a summary of generated commuting routes with details such as origin, destination, total distance, mode of transport, and travel time.
- **simplified_co2_emissions_summary.csv**: Contains the final CO2 emissions calculated for each trip using both standard emission factors and WPM-specific factors.
- **top_origin_addresses.csv** & **top_destination_addresses.csv**: Contain the top origin and destination addresses based on the most common commuting zip codes, with geospatial data (latitude, longitude) for route generation.
- **processed/cleaned_georef-netherlands-postcode-pc4.csv**: Cleaned version of the raw geospatial postcode data for the Netherlands.

## Future Directions

- **CO2 Emissions Calculator Refinement**: Further refinement of the emissions calculator, especially in handling multimodal trips and improving accuracy.
- **Route Generation Expansion**: Expansion of the synthetic route generation to include more flexible origin-destination pairs and increased coverage of routes across the Netherlands.
- **Dataset Integration**: Adding additional datasets to enhance the analysis, such as traffic data, weather data, or energy consumption data for electric vehicles.

## Acknowledgments

This project utilizes data from the ODiN 2022 Travel Survey, provided by [SSH Data Stations](https://ssh.datastations.nl/dataset.xhtml?persistentId=doi:10.17026/SS/BXIK2X). It also uses external APIs such as OpenTripPlanner (OTP) and Nominatim (OSM) for route generation and geocoding, respectively.

